<html>
    <head>
        <meta charset="utf-8">
        <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
        <link rel="manifest" href="favicon/site.webmanifest">
        <title>Compute NOW_AI</title>
    </head>
    <body>
        <button id="solveButton" name="button" onclick="run()">Initialize Cache</button>
        <div id="log" style="font-family: sans-serif;"></div>
        <script>

            let logDiv = document.getElementById('log')
            let total = 0
            let params = {}

            init()

            function init() {

                // set this to the target appserver url
                let url = window.location.href
                url = url.substring(0, url.lastIndexOf('/'))
                url = url.substring(0, url.lastIndexOf('/')) + '/solve'

                params.definition = 'NOW_AI_test1.gh'
                params.url = url

                // The min, max, and step values below should match the values used for the input sliders in index.html

                //resi_percentage
                params.resi_percentage = {}
                params.resi_percentage.min = 20
                params.resi_percentage.max = 90
                params.resi_percentage.step = 1
                params.resi_percentage.cnt = ( params.resi_percentage.max - params.resi_percentage.min ) / params.resi_percentage.step

                //resi_size
                params.resi_size = {}
                params.resi_size.min = 30
                params.resi_size.max = 120
                params.resi_size.step = 1
                params.resi_size.cnt = ( params.resi_size.max - params.resi_size.min ) / params.resi_size.step

                //employment
                params.employment = {}
                params.employment.min = 1
                params.employment.max = 8
                params.employment.step = 1
                params.employment.cnt = ( params.employment.max - params.employment.min ) / params.employment.step

                //commercial_size
                params.commercial_size = {}
                params.commercial_size.min = 30
                params.commercial_size.max = 120
                params.commercial_size.step = 1
                params.commercial_size.cnt = ( params.commercial_size.max - params.commercial_size.min ) / params.commercial_size.step


                total = ( ( params.resi_percentage.cnt + 1 ) * ( params.resi_size.cnt + 1 ) * ( params.employment.cnt + 1 ) * ( params.commercial_size.cnt + 1 ) )

                logDiv.textContent = 'Solutions to solve: ' + total

            }

            function run() {

                document.getElementById('solveButton').disabled = true

                warmUp().then( ()=>{ 
                    console.log('done')
                    logDiv.textContent = 'done'
                } )
            }
            
            async function warmUp() {

                let cnt = 1

                for (let i = params.resi_percentage.min; i <= params.resi_percentage.max; i = i + params.resi_percentage.step) {

                    for (let j = params.resi_size.min; j <= params.resi_size.max; j = j + params.resi_size.step) {
                    
                        for (let k = params.employment.min; k <= params.employment.max; k = k + params.employment.step) {

                            for (let l = params.commercial_size.min; l <= params.commercial_size.max; l = l + params.commercial_size.step) {

                                console.log(`Solution: ${cnt} / ${total}`)
                                logDiv.textContent = `Solution: ${cnt} / ${total}`
                                console.log(`Params: Count ${i} - Radius ${j} - Length ${k}`)

                                let data = {}
                                data.definition = params.definition
                                data.inputs = {
                                    'resi_percentage': i,
                                    'resi_size': j,
                                    'employment': k,
                                    'commercial_size': l
                                }

                                const request = {
                                    'method':'POST',
                                    'body': JSON.stringify(data),
                                    'headers': {'Content-Type': 'application/json'}
                                }

                                let response = await fetch(params.url, request)
                                let responseJson = await response.json()

                                cnt ++

                            }   

                        }

                    }

                }

            }
        </script>
    </body>
</html>
